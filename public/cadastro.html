<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Logaritimos | Cadastro</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./CSS/cadastro.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

</head>

<body onload="listar()">
  <!--Header-->

  <header>
    <div>
      <img src="./assets/imagem/logo.png" alt="">
    </div>
    <div class="links">
      <ul>
        <li><a id="ativo" class="header_botao" href="index.html">Home</a></li>
        <li>|</li>
        <li><a class="header_botao" href="cadastro.html">Cadastro</a></li>
        <li><a class="header_botao" href="login.html">Entrar</a></li>
      </ul>
    </div>
  </header>

  <div class="cadastro">

    <div class="container">

      <div class="parte1">
        <h2>Bem vindo(a)!</h2>
        <p>Entre e desfrute de nossa solução</p>
        <button onclick="window.location.href='login.html'">Login</button>
      </div>

      <div class=" card-cadastro">
        <h2>Cadastre-se</h2>

        <div class="formulario">

          <!-- CADASTRO 1 -->
          <div id="cadastro1" class="cadastro1">
            <div class="campo" style="position: relative;">
              <div class="desenho">
                <img src="./assets/imagem/boneco.png" alt="">
              </div>
              <input id="razaoSocial" type="text" placeholder="Razão Social" />
              <span id="erro-razao" class="msg-erro">Informe a razão social</span>
            </div>

            <div class="campo" style="position: relative;">
              <div class="desenho">
                <img src="./assets/imagem/cnpj.png" alt="">
              </div>
              <input id="cnpj" type="text" placeholder="CNPJ" />
              <span id="erro-cnpj" class="msg-erro">CNPJ inválido</span>
            </div>

            <div class="campo" style="position: relative;">
              <div class="desenho">
                <img src="./assets/imagem/email.png" alt="">
              </div>
              <input id="email_input" type="text" placeholder="Email" />
              <span id="erro-email" class="msg-erro">Digite um email válido</span>
            </div>

            <div class="campo" style="position: relative;">
              <div class="desenho">
                <img src="./assets/imagem/cadeado.png" alt="">
              </div>
              <input id="senha_input" type="password" placeholder="Senha" />
              <i id="toggleSenha" class="fa-solid fa-eye-slash" style="position: absolute; right: 10px; top: 45%; transform: translateY(-50%);
                         cursor: pointer; font-size: 18px; color: #ffffff;"></i>
              <span id="erro-senha" class="msg-erro">
                deve ter 8+ caracteres, maiúscula, minúscula, número e símbolo
              </span>
            </div>

            <div class="campo" style="position: relative;">
              <div class="desenho">
                <img src="./assets/imagem/cadeado.png" alt="">
              </div>
              <input id="confirmacao_senha_input" type="password" placeholder="Confirmar Senha" />
              <i id="toggleConfirmacao" class="fa-solid fa-eye-slash" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
                    cursor: pointer; font-size: 18px; color: #f4f4f4;">
              </i>

              <span id="erro-confirmar" class="msg-erro">As senhas não coincidem</span>
            </div>

            <div class="indicador">
              <p id="etapa" style="color: #00283a;">Etapa 1 de 2</p>
              <button class="botaoGeral" type="button" onclick="irParaCadastro2()">Próximo</button>
            </div>


          </div>
          <!-- CADASTRO 2 -->
          <div class="cadastro2" style="display:none; width: 100%; flex-direction: column; gap: 10px;">

            <div class="voltar" style="margin-bottom: 10px; cursor: pointer;"></div>

            <!-- Linha CEP + UF -->
            <div class="linha-campos">
              <div class="campo">
                <input id="cep" type="text" placeholder="CEP" />
                <span id="erro-cep" class="msg-erro">CEP inválido</span>
              </div>
              <div class="campo">
                <input id="uf" type="text" placeholder="UF" />
              </div>
            </div>

            <div class="campo">
              <input id="cidade" type="text" placeholder="Cidade" />
              <span id="erro-cidade" class="msg-erro">Informe a cidade</span>
            </div>

            <div class="campo">
              <input id="bairro" type="text" placeholder="Bairro" />
              <span id="erro-bairro" class="msg-erro">Informe o bairro</span>
            </div>

            <div class="linha-campos">
              <div class="campo">
                <input id="logradouro" type="text" placeholder="Logradouro" />
              </div>
              <div class="campo">
                <input id="numero" type="text" placeholder="Número" />
              </div>
            </div>

            <div class="campo">
              <input id="complemento" type="text" placeholder="Complemento" />
            </div>

            <div class="botao-final">
              <button class="botaoGeral" type="button" onclick="cadastrar()">Finalizar</button>
            </div>

          </div>



        </div>

      </div>

    </div>

  </div>

  <!--footer inicio-->
  <footer>
    <div>
      <h1>Logaritmo 2025 - TODOS OS DIREITOS RESERVADOS</h1>
    </div>
  </footer>
  <!--footer fim-->

  <script src="./js/validacaoCadastroLogin.js"></script>
</body>

</html>

<script>

  // Voltar para a etapa 1 sem perder dados
  function voltarParaCadastro1() {
    document.querySelector(".cadastro2").style.display = "none";
    document.querySelector(".cadastro1").style.display = "flex";
  }


  function cadastrar() {
    //empresa
    const razaoVar = document.getElementById("razaoSocial").value.trim();
    const cnpjVar = document.getElementById("cnpj").value.trim().replace(/\D/g, "");
    const emailVar = document.getElementById("email_input").value.trim();
    const senhaVar = document.getElementById("senha_input").value;
    const confirmacao_senhaVar = document.getElementById("confirmacao_senha_input").value;
    //endereco
    const estadoVar = document.getElementById("uf").value.trim();
    const cidadeVar = document.getElementById("cidade").value.trim();
    const bairroVar = document.getElementById("bairro").value.trim();
    const logradouroVar = document.getElementById("logradouro").value.trim();
    const numVar = document.getElementById("numero").value.trim();
    const complementoVar = document.getElementById("complemento") ? document.getElementById("complemento").value.trim() : "";
    const cepVar = document.getElementById("cep").value.trim().replace(/\D/g, "");

    if (!razaoVar || !cnpjVar || !emailVar || !senhaVar || !confirmacao_senhaVar ||
      !estadoVar || !cidadeVar || !bairroVar || !logradouroVar || !numVar || !cepVar) {
      return false;
    }

    if (senhaVar !== confirmacao_senhaVar) {
      return false;
    }

    fetch("/empresa/cadastrar-com-endereco", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        razaoSocialServer: razaoVar,
        cnpjServer: cnpjVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
        logradouroServer: logradouroVar,
        numeroServer: numVar,
        complementoServer: complementoVar,
        bairroServer: bairroVar,
        cidadeServer: cidadeVar,
        estadoServer: estadoVar,
        cepServer: cepVar
      })
    })
      .then(response => {
        if (!response.ok) {
          throw new Error("Erro na requisição: " + response.status);
        }
        return response.json();
      })
      .then(data => {
        setTimeout(() => {
          window.location.href = "login.html";
        }, 1000);
      })
      .catch(error => {
        console.error("Erro no cadastro:", error);
      });

    return false;
  }


  function sumirMensagem() {
    cardErro.style.display = "none";
  }


  // --- BOTÕES --- //
  function irParaCadastro2() {
    if (validarFormularioEtapa1()) {
      document.querySelector(".cadastro1").style.display = "none";
      document.querySelector(".cadastro2").style.display = "flex";

      document.querySelector(".voltar").style.display = "block";
    }
  }

  const cadastro1 = document.getElementById("cadastro1");



  // Esconder e aparecer senha 
  const senhaInput = document.getElementById("senha_input");
  const toggleSenha = document.getElementById("toggleSenha");

  toggleSenha.addEventListener("click", () => {
    if (senhaInput.type === "password") {
      senhaInput.type = "text";
      toggleSenha.classList.remove("fa-eye-slash");
      toggleSenha.classList.add("fa-eye");
    } else {
      senhaInput.type = "password";
      toggleSenha.classList.remove("fa-eye");
      toggleSenha.classList.add("fa-eye-slash");
    }
  });

  // Esconder e aparecer senha (Confirmacao)
  const confirmacaoInput = document.getElementById("confirmacao_senha_input");
  const toggleConfirmacao = document.getElementById("toggleConfirmacao");

  toggleConfirmacao.addEventListener("click", () => {
    if (confirmacaoInput.type === "password") {
      confirmacaoInput.type = "text";
      toggleConfirmacao.classList.remove("fa-eye-slash");
      toggleConfirmacao.classList.add("fa-eye");
    } else {
      confirmacaoInput.type = "password";
      toggleConfirmacao.classList.remove("fa-eye");
      toggleConfirmacao.classList.add("fa-eye-slash");
    }
  });

</script>